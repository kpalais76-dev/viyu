<view class="container">
  
  <view class="page-title">📝 新增鱼获记录</view>

  <view class="card env-card">
    <view class="row">
      <text class="label">📍 地点</text>
      <text class="value">{{locationText}}</text>
    </view>
    <view class="row">
      <text class="label">🌤 天气</text>
      <text class="value">{{weatherText}}</text>
    </view>
  </view>

  <view class="card form-card">
    <view class="form-item">
      <text class="label">🐟 鱼种</text>
      <picker bindchange="bindSpeciesChange" value="{{speciesIndex}}" range="{{speciesList}}" range-key="name">
        <view class="picker-val">
          {{speciesList[speciesIndex].name || '加载中...'}}
          <text class="arrow">▼</text>
        </view>
      </picker>
    </view>

    <view class="form-row-split">
      <view class="split-item">
        <text class="label">⚖️ 重量 (斤)</text>
        <input class="input-box" type="digit" placeholder="0.0" data-field="weight" bindinput="handleInput" />
      </view>
      <view class="split-item">
        <text class="label">📏 长度 (cm)</text>
        <input class="input-box" type="digit" placeholder="0" data-field="length" bindinput="handleInput" />
      </view>
    </view>
  </view>

  <view class="card form-card">
    <view class="form-item">
      <text class="label">🎣 使用鱼竿</text>
      <picker bindchange="bindRodChange" value="{{rodIndex}}" range="{{myRods}}" range-key="name">
        <view class="picker-val">
          {{myRods[rodIndex].name || '无装备(请先去进货)'}}
          <text class="arrow">▼</text>
        </view>
      </picker>
    </view>
    
    <view class="form-item">
      <text class="label">🧵 线组配置</text>
      <input class="input-no-border" placeholder="例: 1.5主+0.8子" data-field="line_group" bindinput="handleInput" />
    </view>
  </view>

  <view class="card form-card">
    <text class="label-block">🏷 技法与漂相 (多选)</text>
    <view class="tags-container">
      <block wx:for="{{tagOptions}}" wx:key="*this">
        <view 
          class="tag {{utils.includes(formData.tags, item) ? 'active' : ''}}" 
          bindtap="toggleTag" 
          data-tag="{{item}}"
        >
          {{item}}
        </view>
      </block>
    </view>
  </view>

  <view class="footer-btn-area">
    <button class="btn-save" bindtap="handleSave">确认归档</button>
  </view>

</view>

<wxs module="utils">
  module.exports.includes = function(arr, item) {
    return arr.indexOf(item) > -1;
  }
</wxs>