<view class="container">
  
  <view class="status-bar">
    <view class="page-title">战术配置台</view>
    <view class="mode-badge">
      <text class="mode-label">模式</text>
      <text class="mode-val">{{methodName}}</text>
    </view>
  </view>

  <view class="group-title">战术模组序列</view>
  <view class="card">
    <block wx:for="{{activeSlots}}" wx:key="key">
      <picker 
        bindchange="bindPick" 
        data-key="{{item.key}}" 
        value="{{selections[item.key]}}" 
        range="{{inventory[item.key]}}" 
        range-key="name"
      >
        <view class="form-item">
          <text class="label">{{item.name}} <text class="icon">{{item.icon}}</text></text>
          
          <view class="picker-val {{selections[item.key] > -1 ? '' : 'placeholder'}}">
            {{selections[item.key] > -1 ? inventory[item.key][selections[item.key]].name : '点击装配'}} 
            <text class="arrow">▼</text>
          </view>
        </view>
      </picker>
    </block>

    <view wx:if="{{activeSlots.length > 0 && (!inventory[activeSlots[0].key] || inventory[activeSlots[0].key].length === 0)}}" class="empty-hint" style="text-align:center; padding:20rpx; color:#999; font-size:24rpx;">
      暂无适配装备，请先去录入
    </view>
  </view>

  <view class="group-title">方案标识</view>
  <view class="card">
    <view class="form-item">
      <text class="label">代号<text class="req">*</text></text>
      <input class="input-box" placeholder="例: 巨物杀手 Type-A" placeholder-style="color:#ccc; font-weight:normal" data-field="setupName" value="{{setupName}}" bindinput="handleInput" />
    </view>
    <view class="form-item">
      <text class="label">战术备注</text>
      <input class="input-box" placeholder="适用场景 / 对象鱼" placeholder-style="color:#ccc; font-weight:normal" data-field="desc" value="{{desc}}" bindinput="handleInput" />
    </view>
  </view>

  <view class="share-area" wx:if="{{editId}}">
    <view class="share-title">⚡ 战术分享</view>
    <view class="share-btn-row">
      <view class="share-btn code" bindtap="handleCopyCode">
        <text>🔗 复制配置口令</text>
      </view>
      <view class="share-btn poster" bindtap="handleGeneratePoster">
        <text>🖼️ 生成战术蓝图</text>
      </view>
    </view>
  </view>

  <view class="footer">
    <button class="btn-save" bindtap="handleSave">{{editId ? '更新配置' : '保存并生成口令'}}</button>
  </view>

  <view class="poster-modal" wx:if="{{showPosterModal}}">
    <view class="modal-mask" bindtap="closePosterModal"></view>
    <view class="modal-content">
      <view class="modal-header">战术蓝图已生成</view>
      <image src="{{posterUrl}}" class="poster-preview" mode="widthFix"></image>
      <view class="modal-actions">
        <button class="action-btn save" bindtap="savePosterToPhone">
          <text>⬇️ 保存到相册</text>
        </button>
        <button class="action-btn close" bindtap="closePosterModal">关闭</button>
      </view>
    </view>
  </view>

  <canvas type="2d" id="shareCanvas" style="width: 375px; height: 1200px; position: fixed; left: -9999px;"></canvas>

</view>